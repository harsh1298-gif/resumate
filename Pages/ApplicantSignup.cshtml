@page
@model RESUMATE_FINAL_WORKING_MODEL.Pages.ApplicantSignupModel
@{
    ViewData["Title"] = "Applicant Registration";
}

<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8 px-4 sm:px-6 lg:px-8">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-3">Join Resumate</h1>
            <p class="text-lg text-gray-600">Create your applicant account and start your career journey</p>
        </div>

        <!-- Main Card -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <!-- Gradient Header -->
            <div class="bg-gradient-to-r from-blue-600 to-purple-700 px-6 py-8 sm:px-8 sm:py-10">
                <div class="text-center">
                    <h2 class="text-3xl font-bold text-white mb-2">Applicant Registration</h2>
                    <p class="text-blue-100 text-lg">Build your professional profile in minutes</p>
                </div>
            </div>

            <!-- Form Section -->
            <div class="px-6 py-8 sm:px-8 sm:py-10">
                <form method="post" enctype="multipart/form-data" id="registrationForm">
                    <div asp-validation-summary="ModelOnly" class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700"></div>

                    <!-- Account Information -->
                    <div class="mb-10">
                        <h3 class="text-2xl font-semibold text-gray-900 mb-6 pb-3 border-b-2 border-gray-200 relative">
                            Account Information
                            <span class="absolute bottom-0 left-0 w-16 h-1 bg-blue-600 rounded-full"></span>
                        </h3>

                        <!-- Email -->
                        <div class="mb-6">
                            <label asp-for="Input.Email" class="block text-sm font-medium text-gray-700 mb-2">
                                📧 Email Address
                            </label>
                            <input asp-for="Input.Email"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                                   autocomplete="email"
                                   placeholder="Enter your email address" />
                            <span asp-validation-for="Input.Email" class="mt-1 text-sm text-red-600"></span>
                        </div>

                        <!-- Password Fields -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Password -->
                            <div>
                                <label asp-for="Input.Password" class="block text-sm font-medium text-gray-700 mb-2">
                                    🔒 Password
                                </label>
                                <input asp-for="Input.Password" type="password"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                                       autocomplete="new-password"
                                       placeholder="Create a password" />
                                <span asp-validation-for="Input.Password" class="mt-1 text-sm text-red-600"></span>

                                <!-- Password Requirements -->
                                <div class="mt-3 p-3 bg-gray-50 rounded-lg border border-gray-200">
                                    <p class="text-sm font-medium text-gray-700 mb-2">Password Requirements:</p>
                                    <div class="space-y-1">
                                        <div class="flex items-center text-sm" id="lengthReq">
                                            <span class="w-2 h-2 bg-red-400 rounded-full mr-2"></span>
                                            At least 6 characters
                                        </div>
                                        <div class="flex items-center text-sm" id="upperReq">
                                            <span class="w-2 h-2 bg-red-400 rounded-full mr-2"></span>
                                            One uppercase letter
                                        </div>
                                        <div class="flex items-center text-sm" id="numberReq">
                                            <span class="w-2 h-2 bg-red-400 rounded-full mr-2"></span>
                                            One number
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Confirm Password -->
                            <div>
                                <label asp-for="Input.ConfirmPassword" class="block text-sm font-medium text-gray-700 mb-2">
                                    🔒 Confirm Password
                                </label>
                                <input asp-for="Input.ConfirmPassword" type="password"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                                       autocomplete="new-password"
                                       placeholder="Confirm your password" />
                                <span asp-validation-for="Input.ConfirmPassword" class="mt-1 text-sm text-red-600"></span>
                                <div id="passwordMatch" class="mt-2 text-sm text-green-600 hidden">
                                    ✅ Passwords match
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Personal Information -->
                    <div class="mb-10">
                        <h3 class="text-2xl font-semibold text-gray-900 mb-6 pb-3 border-b-2 border-gray-200 relative">
                            Personal Information
                            <span class="absolute bottom-0 left-0 w-16 h-1 bg-purple-600 rounded-full"></span>
                        </h3>

                        <!-- Name and Date of Birth -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label asp-for="Input.FullName" class="block text-sm font-medium text-gray-700 mb-2">
                                    👤 Full Name
                                </label>
                                <input asp-for="Input.FullName"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                                       autocomplete="name"
                                       placeholder="Enter your full name" />
                                <span asp-validation-for="Input.FullName" class="mt-1 text-sm text-red-600"></span>
                            </div>

                            <div>
                                <label asp-for="Input.DateOfBirth" class="block text-sm font-medium text-gray-700 mb-2">
                                    📅 Date of Birth
                                </label>
                                <input asp-for="Input.DateOfBirth"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                                       type="date" />
                                <span asp-validation-for="Input.DateOfBirth" class="mt-1 text-sm text-red-600"></span>
                                <div id="ageWarning" class="mt-2 text-sm text-amber-600 hidden">
                                    ⚠️ You must be at least 18 years old
                                </div>
                            </div>
                        </div>

                        <!-- Phone and City -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label asp-for="Input.PhoneNumber" class="block text-sm font-medium text-gray-700 mb-2">
                                    📞 Phone Number
                                </label>
                                <input asp-for="Input.PhoneNumber"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                                       autocomplete="tel"
                                       placeholder="Enter your phone number" />
                                <span asp-validation-for="Input.PhoneNumber" class="mt-1 text-sm text-red-600"></span>
                            </div>

                            <div>
                                <label asp-for="Input.City" class="block text-sm font-medium text-gray-700 mb-2">
                                    🏙️ City
                                </label>
                                <input asp-for="Input.City"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                                       autocomplete="address-level2"
                                       placeholder="Enter your city" />
                                <span asp-validation-for="Input.City" class="mt-1 text-sm text-red-600"></span>
                            </div>
                        </div>

                        <!-- Address -->
                        <div class="mb-6">
                            <label asp-for="Input.Address" class="block text-sm font-medium text-gray-700 mb-2">
                                🏠 Address
                            </label>
                            <textarea asp-for="Input.Address"
                                      class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                                      rows="3"
                                      autocomplete="street-address"
                                      placeholder="Enter your complete address"></textarea>
                            <span asp-validation-for="Input.Address" class="mt-1 text-sm text-red-600"></span>
                        </div>

                        <!-- Pincode and Profile Photo -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label asp-for="Input.Pincode" class="block text-sm font-medium text-gray-700 mb-2">
                                    📮 Pincode
                                </label>
                                <input asp-for="Input.Pincode"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                                       autocomplete="postal-code"
                                       placeholder="Enter pincode" />
                                <span asp-validation-for="Input.Pincode" class="mt-1 text-sm text-red-600"></span>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    📷 Profile Photo
                                </label>
                                <div class="flex items-center space-x-3">
                                    <label for="profilePhoto" class="cursor-pointer">
                                        <span class="px-4 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors duration-200 font-medium inline-flex items-center">
                                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                            </svg>
                                            Choose File
                                        </span>
                                        <input asp-for="Input.ProfilePhoto" id="profilePhoto" class="hidden" type="file" accept="image/*" />
                                    </label>
                                    <span id="fileName" class="text-sm text-gray-500">No file chosen</span>
                                </div>
                                <span asp-validation-for="Input.ProfilePhoto" class="mt-1 text-sm text-red-600"></span>
                                <p class="mt-1 text-sm text-gray-500">Max file size: 5MB • Formats: JPG, PNG, GIF</p>

                                <!-- Image Preview -->
                                <div id="imagePreview" class="mt-3 hidden">
                                    <div class="border-2 border-dashed border-gray-300 rounded-xl p-4 bg-gray-50">
                                        <img id="preview" src="#" alt="Profile Preview" class="max-w-xs mx-auto rounded-lg shadow-sm" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Terms and Conditions -->
                    <div class="mb-8">
                        <div class="flex items-start space-x-3">
                            <input asp-for="Input.TermsAccepted"
                                   class="mt-1 w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                                   type="checkbox" />
                            <label asp-for="Input.TermsAccepted" class="text-sm text-gray-700">
                                I accept the
                                <a href="#" class="text-blue-600 hover:text-blue-800 font-medium underline" onclick="showTermsModal()">
                                    terms and conditions
                                </a>
                            </label>
                        </div>
                        <span asp-validation-for="Input.TermsAccepted" class="mt-1 text-sm text-red-600 block"></span>
                    </div>

                    <!-- Submit Button -->
                    <div class="mb-6">
                        <button type="submit"
                                class="w-full bg-gradient-to-r from-blue-600 to-purple-700 text-white py-4 px-6 rounded-xl font-semibold text-lg hover:from-blue-700 hover:to-purple-800 transform hover:-translate-y-1 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center justify-center">
                            <div id="submitSpinner" class="hidden animate-spin rounded-full h-6 w-6 border-b-2 border-white mr-3"></div>
                            <span id="submitText">Create My Account</span>
                        </button>
                    </div>

                    <!-- Login Link -->
                    <div class="text-center">
                        <p class="text-gray-600">
                            Already have an account?
                            <a asp-page="/Login" class="text-blue-600 hover:text-blue-800 font-semibold">Sign in here</a>
                        </p>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Terms and Conditions Modal -->
<div id="termsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-2xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden">
        <div class="bg-gradient-to-r from-blue-600 to-purple-700 px-6 py-4 text-white">
            <div class="flex justify-between items-center">
                <h3 class="text-xl font-semibold">Terms and Conditions</h3>
                <button type="button" onclick="hideTermsModal()" class="text-white hover:text-gray-200 text-2xl">&times;</button>
            </div>
        </div>
        <div class="p-6 overflow-y-auto max-h-[60vh]">
            <div class="space-y-4">
                <div>
                    <h4 class="font-semibold text-gray-900 mb-2">1. Acceptance of Terms</h4>
                    <p class="text-gray-600">By creating an account on Resumate, you agree to be bound by these Terms and Conditions and our Privacy Policy.</p>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-900 mb-2">2. User Responsibilities</h4>
                    <p class="text-gray-600">You are responsible for maintaining the confidentiality of your account credentials and for all activities that occur under your account.</p>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-900 mb-2">3. Profile Information</h4>
                    <p class="text-gray-600">You agree to provide accurate, current, and complete information during the registration process and to update such information to keep it accurate.</p>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-900 mb-2">4. Privacy</h4>
                    <p class="text-gray-600">We respect your privacy and are committed to protecting your personal information in accordance with our Privacy Policy.</p>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-900 mb-2">5. Account Termination</h4>
                    <p class="text-gray-600">We reserve the right to suspend or terminate accounts that violate our policies or engage in fraudulent activities.</p>
                </div>
            </div>
        </div>
        <div class="bg-gray-50 px-6 py-4 flex justify-end">
            <button type="button" onclick="hideTermsModal()" class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors duration-200">
                I Understand
            </button>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        // Terms Modal Functions
        function showTermsModal() {
            event.preventDefault();
            document.getElementById('termsModal').classList.remove('hidden');
        }

        function hideTermsModal() {
            document.getElementById('termsModal').classList.add('hidden');
        }

        // Image preview function
        document.getElementById('profilePhoto').addEventListener('change', function(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('preview');
            const previewContainer = document.getElementById('imagePreview');
            const fileName = document.getElementById('fileName');

            if (file) {
                fileName.textContent = file.name;

                // Validate file size (5MB)
                const maxSize = 5 * 1024 * 1024;
                if (file.size > maxSize) {
                    alert('File size must not exceed 5MB');
                    event.target.value = '';
                    previewContainer.classList.add('hidden');
                    fileName.textContent = 'No file chosen';
                    return;
                }

                // Validate file type
                const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
                if (!allowedTypes.includes(file.type)) {
                    alert('Only JPG, JPEG, PNG, and GIF files are allowed');
                    event.target.value = '';
                    previewContainer.classList.add('hidden');
                    fileName.textContent = 'No file chosen';
                    return;
                }

                // Show preview
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    previewContainer.classList.remove('hidden');
                }
                reader.readAsDataURL(file);
            } else {
                previewContainer.classList.add('hidden');
                fileName.textContent = 'No file chosen';
            }
        });

        // Password strength validation
        document.addEventListener('DOMContentLoaded', function () {
            const passwordInput = document.querySelector('input[name="Input.Password"]');
            const confirmInput = document.querySelector('input[name="Input.ConfirmPassword"]');
            const dobInput = document.querySelector('input[name="Input.DateOfBirth"]');

            if (passwordInput) {
                passwordInput.addEventListener('input', function () {
                    validatePassword(this.value);
                    checkPasswordMatch();
                });
            }

            if (confirmInput) {
                confirmInput.addEventListener('input', checkPasswordMatch);
            }

            if (dobInput) {
                dobInput.addEventListener('change', function () {
                    validateAge(this.value);
                });
            }

            // Form submission enhancement
            const form = document.getElementById('registrationForm');
            if (form) {
                form.addEventListener('submit', function (e) {
                    const submitBtn = document.querySelector('button[type="submit"]');
                    const spinner = document.getElementById('submitSpinner');
                    const text = document.getElementById('submitText');

                    if (submitBtn && spinner && text) {
                        // Show loading state
                        submitBtn.disabled = true;
                        spinner.classList.remove('hidden');
                        text.textContent = 'Creating Account...';
                    }
                });
            }
        });

        function validatePassword(password) {
            const lengthReq = document.getElementById('lengthReq');
            const upperReq = document.getElementById('upperReq');
            const numberReq = document.getElementById('numberReq');

            if (lengthReq) updateRequirement(lengthReq, password.length >= 6);
            if (upperReq) updateRequirement(upperReq, /[A-Z]/.test(password));
            if (numberReq) updateRequirement(numberReq, /[0-9]/.test(password));
        }

        function updateRequirement(element, isValid) {
            const dot = element.querySelector('span');
            if (dot) {
                if (isValid) {
                    dot.classList.remove('bg-red-400');
                    dot.classList.add('bg-green-500');
                    element.classList.remove('text-gray-600');
                    element.classList.add('text-green-600');
                } else {
                    dot.classList.remove('bg-green-500');
                    dot.classList.add('bg-red-400');
                    element.classList.remove('text-green-600');
                    element.classList.add('text-gray-600');
                }
            }
        }

        function checkPasswordMatch() {
            const passwordInput = document.querySelector('input[name="Input.Password"]');
            const confirmInput = document.querySelector('input[name="Input.ConfirmPassword"]');
            const matchElement = document.getElementById('passwordMatch');

            if (passwordInput && confirmInput && matchElement) {
                const password = passwordInput.value;
                const confirm = confirmInput.value;

                if (confirm && password === confirm) {
                    matchElement.classList.remove('hidden');
                } else {
                    matchElement.classList.add('hidden');
                }
            }
        }

        function validateAge(dateOfBirth) {
            const ageWarning = document.getElementById('ageWarning');
            if (!ageWarning || !dateOfBirth) return;

            const today = new Date();
            const birthDate = new Date(dateOfBirth);
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();

            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }

            if (age < 18) {
                ageWarning.classList.remove('hidden');
            } else {
                ageWarning.classList.add('hidden');
            }
        }

        // Close modal when clicking outside
        document.getElementById('termsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideTermsModal();
            }
        });
    </script>
}