@page
@model RESUMATE_FINAL_WORKING_MODEL.Pages.ResumeBuilderModel
@{
    ViewData["Title"] = "Resume Builder";
}

<div class="min-h-screen bg-gray-50">
    <!-- Header -->
    <div class="bg-gradient-to-r from-purple-600 to-purple-800 text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
            <h1 class="text-3xl sm:text-4xl font-bold mb-2">Resume Builder</h1>
            <p class="text-purple-100 text-base sm:text-lg">Upload and manage your resume (PDF only)</p>
        </div>
    </div>

    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Success/Error Messages -->
        @if (TempData["Success"] != null)
        {
            <div class="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg">
                <p class="text-green-800">
                    <i class="fas fa-check-circle mr-2"></i>@TempData["Success"]
                </p>
            </div>
        }

        @if (TempData["Error"] != null)
        {
            <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
                <p class="text-red-800">
                    <i class="fas fa-exclamation-circle mr-2"></i>@TempData["Error"]
                </p>
            </div>
        }

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Main Content -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Current Resume -->
                @if (Model.HasExistingResume)
                {
                    <div class="bg-white rounded-lg shadow p-6 border-l-4 border-green-500">
                        <h2 class="text-2xl font-bold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-file-pdf text-red-600 mr-2"></i>
                            Current Resume
                        </h2>

                        <div class="flex items-start space-x-4 p-4 bg-gray-50 rounded-lg">
                            <div class="flex-shrink-0">
                                <i class="@Model.GetFileIcon(Model.CurrentResumeFileName) text-4xl"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h3 class="text-lg font-semibold text-gray-900 break-words">
                                    @Model.CurrentResumeFileName
                                </h3>
                                <p class="text-sm text-gray-600 mt-1">
                                    <i class="fas fa-hdd mr-1"></i>Size: @Model.GetFileSize(Model.CurrentResumeFilePath)
                                </p>
                                @if (Model.CurrentApplicant?.ResumeUploadDate.HasValue == true)
                                {
                                    <p class="text-sm text-gray-600">
                                        <i class="fas fa-calendar mr-1"></i>Uploaded: @Model.CurrentApplicant.ResumeUploadDate.Value.ToString("MMM dd, yyyy")
                                    </p>
                                }
                            </div>
                        </div>

                        <div class="flex flex-col sm:flex-row gap-3 mt-4">
                            <a href="@Model.CurrentResumeFilePath" target="_blank" download
                               class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-center">
                                <i class="fas fa-download mr-2"></i>Download Resume
                            </a>
                            <a href="@Model.CurrentResumeFilePath" target="_blank"
                               class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors text-center">
                                <i class="fas fa-eye mr-2"></i>Preview Resume
                            </a>
                            <form method="post" asp-page-handler="Delete"
                                  onsubmit="return confirm('Are you sure you want to delete your resume? This action cannot be undone.');"
                                  class="flex-1">
                                <button type="submit"
                                        class="w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                                    <i class="fas fa-trash mr-2"></i>Delete Resume
                                </button>
                            </form>
                        </div>
                    </div>
                }

                <!-- Upload New Resume -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4 flex items-center">
                        <i class="fas fa-upload text-purple-600 mr-2"></i>
                        @(Model.HasExistingResume ? "Replace Resume" : "Upload Resume")
                    </h2>

                    <form method="post" asp-page-handler="Upload" enctype="multipart/form-data" class="space-y-4">
                        <!-- File Upload Area -->
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-purple-500 transition-colors">
                            <i class="fas fa-file-pdf text-6xl text-red-500 mb-4"></i>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">
                                Choose a PDF file or drag it here
                            </h3>
                            <p class="text-sm text-gray-600 mb-1">
                                <strong>PDF format only</strong>
                            </p>
                            <p class="text-xs text-gray-500 mb-4">
                                Maximum file size: 5MB
                            </p>

                            <div class="flex justify-center">
                                <label class="cursor-pointer">
                                    <span class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors inline-block">
                                        <i class="fas fa-folder-open mr-2"></i>Browse PDF Files
                                    </span>
                                    <input type="file" asp-for="Input.ResumeFile"
                                           accept=".pdf"
                                           class="hidden"
                                           onchange="displayFileName(this)">
                                </label>
                            </div>

                            <div id="fileNameDisplay" class="mt-4 text-sm text-gray-700 font-medium"></div>
                            <span asp-validation-for="Input.ResumeFile" class="text-red-600 text-sm block mt-2"></span>
                        </div>

                        <!-- Important Notice -->
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <div class="flex items-start">
                                <i class="fas fa-info-circle text-red-600 text-xl mt-1 mr-3 flex-shrink-0"></i>
                                <div>
                                    <h4 class="font-semibold text-red-800 mb-1">PDF Only</h4>
                                    <p class="text-sm text-red-700">
                                        Only PDF files are accepted. If your resume is in Word or other formats, please convert it to PDF before uploading.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Upload Button -->
                        <button type="submit"
                                class="w-full px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-semibold text-lg">
                            <i class="fas fa-upload mr-2"></i>Upload PDF Resume
                        </button>
                    </form>
                </div>

                <!-- Resume Tips -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                    <h3 class="text-lg font-bold text-blue-900 mb-4 flex items-center">
                        <i class="fas fa-lightbulb text-yellow-500 mr-2"></i>
                        Resume Tips
                    </h3>
                    <ul class="space-y-2 text-sm text-blue-800">
                        <li class="flex items-start">
                            <i class="fas fa-check text-blue-600 mt-1 mr-2 flex-shrink-0"></i>
                            <span>Keep your resume updated with your latest experience and skills</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check text-blue-600 mt-1 mr-2 flex-shrink-0"></i>
                            <span>Use a clear, professional format that's easy to read</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check text-blue-600 mt-1 mr-2 flex-shrink-0"></i>
                            <span>Tailor your resume for each job application when possible</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check text-blue-600 mt-1 mr-2 flex-shrink-0"></i>
                            <span>Highlight achievements and quantifiable results</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check text-blue-600 mt-1 mr-2 flex-shrink-0"></i>
                            <span>Proofread carefully for spelling and grammar errors</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check text-blue-600 mt-1 mr-2 flex-shrink-0"></i>
                            <span><strong>PDF format is required</strong> to ensure compatibility across all devices</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check text-blue-600 mt-1 mr-2 flex-shrink-0"></i>
                            <span>Ensure your PDF contains searchable text, not just scanned images</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Profile Completeness -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">Profile Status</h3>

                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-700">Resume (PDF)</span>
                            @if (Model.HasExistingResume)
                            {
                                <i class="fas fa-check-circle text-green-600 text-xl"></i>
                            }
                            else
                            {
                                <i class="fas fa-times-circle text-red-600 text-xl"></i>
                            }
                        </div>

                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-700">Experience</span>
                            @if (Model.CurrentApplicant?.Experiences?.Any() == true)
                            {
                                <span class="text-green-600 font-semibold">@Model.CurrentApplicant.Experiences.Count</span>
                            }
                            else
                            {
                                <i class="fas fa-times-circle text-red-600 text-xl"></i>
                            }
                        </div>

                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-700">Education</span>
                            @if (Model.CurrentApplicant?.Educations?.Any() == true)
                            {
                                <span class="text-green-600 font-semibold">@Model.CurrentApplicant.Educations.Count</span>
                            }
                            else
                            {
                                <i class="fas fa-times-circle text-red-600 text-xl"></i>
                            }
                        </div>

                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-700">Skills</span>
                            @if (Model.CurrentApplicant?.ApplicantSkills?.Any() == true)
                            {
                                <span class="text-green-600 font-semibold">@Model.CurrentApplicant.ApplicantSkills.Count</span>
                            }
                            else
                            {
                                <i class="fas fa-times-circle text-red-600 text-xl"></i>
                            }
                        </div>
                    </div>

                    <div class="mt-6 pt-6 border-t">
                        <a asp-page="/EditProfile"
                           class="block w-full text-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                            <i class="fas fa-edit mr-2"></i>Edit Profile
                        </a>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">Quick Actions</h3>

                    <div class="space-y-3">
                        <a asp-page="/BrowseJobs"
                           class="block w-full text-center px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                            <i class="fas fa-search mr-2"></i>Browse Jobs
                        </a>
                        <a asp-page="/MyApplications"
                           class="block w-full text-center px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                            <i class="fas fa-list mr-2"></i>My Applications
                        </a>
                        <a asp-page="/Dashboard"
                           class="block w-full text-center px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                            <i class="fas fa-home mr-2"></i>Dashboard
                        </a>
                    </div>
                </div>

                <!-- PDF Requirements -->
                <div class="bg-red-50 border border-red-300 rounded-lg p-4">
                    <h4 class="font-semibold text-red-900 mb-2 flex items-center text-sm">
                        <i class="fas fa-file-pdf mr-2"></i>
                        PDF Requirements
                    </h4>
                    <ul class="space-y-1 text-xs text-red-800">
                        <li>* <strong>PDF format only</strong></li>
                        <li>* Maximum file size: 5MB</li>
                        <li>* Minimum file size: 10KB</li>
                        <li>* Use professional formatting</li>
                        <li>* Include contact information</li>
                        <li>* Keep it concise (1-2 pages)</li>
                        <li>* Ensure text is searchable (not scanned)</li>
                        <li>* Use standard fonts</li>
                    </ul>
                </div>

                <!-- Convert to PDF Help -->
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <h4 class="font-semibold text-yellow-900 mb-2 flex items-center text-sm">
                        <i class="fas fa-question-circle mr-2"></i>
                        Need to Convert?
                    </h4>
                    <p class="text-xs text-yellow-800 mb-2">
                        If your resume is in Word (.doc/.docx) format:
                    </p>
                    <ul class="space-y-1 text-xs text-yellow-800">
                        <li>* Open in Word - File - Save As - PDF</li>
                        <li>* Or use online tools like SmallPDF</li>
                        <li>* Google Docs: File - Download - PDF</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        function displayFileName(input) {
            var fileNameDisplay = document.getElementById('fileNameDisplay');
            if (input.files && input.files[0]) {
                var file = input.files[0];
                var fileName = file.name;
                var fileSize = (file.size / 1024 / 1024).toFixed(2);
                var fileExtension = fileName.split('.').pop().toLowerCase();

                if (fileExtension === 'pdf') {
                    fileNameDisplay.innerHTML = '<div class="flex items-center justify-center space-x-2 text-green-700">' +
                        '<i class="fas fa-file-pdf text-red-600"></i>' +
                        '<span class="font-semibold">' + fileName + '</span>' +
                        '<span class="text-gray-500">(' + fileSize + ' MB)</span>' +
                        '<i class="fas fa-check-circle text-green-600"></i>' +
                        '</div>';
                } else {
                    fileNameDisplay.innerHTML = '<div class="flex items-center justify-center space-x-2 text-red-700">' +
                        '<i class="fas fa-exclamation-triangle text-red-600"></i>' +
                        '<span class="font-semibold">Invalid file: ' + fileName + '</span>' +
                        '<i class="fas fa-times-circle text-red-600"></i>' +
                        '</div>' +
                        '<p class="text-xs text-red-600 mt-2">Only PDF files are allowed</p>';
                }
            } else {
                fileNameDisplay.innerHTML = '';
            }
        }
    </script>
}
